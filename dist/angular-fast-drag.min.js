!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("angular")):"function"==typeof define&&define.amd?define(["angular"],r):"object"==typeof exports?exports.AngularFastDrag=r(require("angular")):t.AngularFastDrag=r(t.angular)}(this,function(t){return function(t){function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var e={};return r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,r,e){Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:e})},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="",r(r.s=1)}([function(r,e){r.exports=t},function(t,r,e){var a=e(0);t.exports="ngFastDrag";var n=a.module(t.exports,[]);n.factory("dragContext",["$rootElement",function(t){function r(){return a.extend(n,{data:null,reset:r,start:e})}function e(t){return n.data=t,t}var n={};return r()}]),n.run(["$rootElement","$timeout",function(t,r){function e(t){n()}function a(t){n()}function n(){r(function(){t.removeClass("drag-active")})}t[0].addEventListener("dragend",e,!0),t[0].addEventListener("drop",a,!0)}]),n.directive("dragContainer",["$rootElement","$parse","$timeout","dragContext",function(t,r,e,a){return{restrict:"A",link:function(n,o,d){function l(r){if(r.preventDefault(),e(function(){t.addClass("drag-active")},0,!1),a.start(d.dragData?n.$eval(d.dragData):o),o.addClass("drag-container-active"),s){var l={$event:r,$dragData:a.data};n.$apply(function(){s(n,l)})}}function i(r){if(r.preventDefault(),e(function(){t.removeClass("drag-active")},0,!1),a.reset(),o.removeClass("drag-container-active"),g){var d={$event:r,$dragData:a.data};n.$apply(function(){g(n,d)})}a.lastTarget&&a.lastTarget.$attrs.$removeClass("drag-over")}var s=d.onDragStart?r(d.onDragStart):null,g=d.onDragEnd?r(d.onDragEnd):null;d.$addClass("drag-container"),n.$watch(d.dragContainer,function(t){d.$set("draggable","undefined"==typeof t||t)}),o.on("dragstart",l),o.on("dragend",i)}}}]),n.directive("dropContainer",["$document","$parse","$window","dragContext",function(t,r,e,n){function o(t){return t[0]||t}function d(r){r=o(r);var n=r.getBoundingClientRect();return{width:Math.round(a.isNumber(n.width)?n.width:r.offsetWidth),height:Math.round(a.isNumber(n.height)?n.height:r.offsetHeight),top:Math.round(n.top+(e.pageYOffset||t[0].documentElement.scrollTop)),left:Math.round(n.left+(e.pageXOffset||t[0].documentElement.scrollLeft))}}return{restrict:"A",require:"dropContainer",controller:"DropContainerController",controllerAs:"dropContainer",link:function(t,e,o,l){function i(r){n.lastTarget&&n.lastTarget!==e&&n.lastTarget.$attrs.$removeClass("drag-over"),n.lastTarget={$attrs:o,$element:e};var a={$event:r,$dragData:n.data};u(t,a)&&(r.preventDefault(),o.$addClass("drag-over"),f&&t.$apply(function(){f(t,a)}))}function s(r){var i={$event:r,$dragData:n.data};if(u(t,i)){r.preventDefault();var s=d(e);o.$addClass("drag-over");var g=Number.MAX_VALUE,c=s.width,f=s.height,v=r.pageX-s.left,$=r.pageY-s.top,h=l.lastTarget;a.forEach(l.targets,function(t,r){var e=c/2,a=f/2;r.indexOf("left")>=0&&(e=1*c/4),r.indexOf("top")>=0&&(a=1*f/4),r.indexOf("right")>=0&&(e=3*c/4),r.indexOf("bottom")>=0&&(a=3*f/4);var n=Math.pow(e-v,2)+Math.pow(a-$,2);n<g&&(h=t,g=n)}),t.$apply(function(){p&&p(t,i),h&&(h!==l.lastTarget&&(l.lastTarget&&o.$removeClass("drop-container-"+l.lastTarget.anchor),o.$addClass("drop-container-"+h.anchor),l.lastTarget&&l.lastTarget.handleDragLeave(r,i),h.handleDragEnter(r,i),l.lastTarget=h),h.handleDragOver(r))})}}function g(r){o.$removeClass("drag-over");var e={$event:r,$dragData:n.data};t.$apply(function(){v&&v(t,e),l.lastTarget&&l.lastTarget.handleDragLeave(r,e),l.lastTarget&&(o.$removeClass("drop-container-"+l.lastTarget.anchor),l.lastTarget=null)})}function c(r){n.lastTarget&&n.lastTarget.$attrs.$removeClass("drag-over");var e={$event:r,$dragData:n.data};u(t,e)&&(r.preventDefault(),n.reset(),t.$apply(function(){$&&$(t,e),l.lastTarget&&l.lastTarget.handleDrop(r,e)})),l.lastTarget&&o.$removeClass("drop-container-"+l.lastTarget.anchor),l.lastTarget=null}var u=o.dropAccepts?r(o.dropAccepts):function(t,r){return"undefined"!=typeof r.$dragData},f=o.onDragEnter?r(o.onDragEnter):null,p=o.onDragOver?r(o.onDragOver):null,v=o.onDragLeave?r(o.onDragLeave):null,$=o.onDrop?r(o.onDrop):null;o.$addClass("drop-container"),p&&e.on("dragover",s),e.on("dragenter",i),e.on("dragleave",g),e.on("drop",c)}}}]),n.controller("DropContainerController",[function(){var t=this,r="center top top-right right bottom-right bottom bottom-left left top-left".split(" ");t.targets={},t.lastTarget=null,t.attach=function(e){var a=e.anchor;if(r.indexOf(a)<0)throw new Error("Invalid drop target anchor `"+a+"`.");return t.targets[a]=e,e},t.detach=function(e){var a=e.anchor;if(r.indexOf(a)<0)throw new Error("Invalid drop target anchor `"+a+"`.");if(!t.targets[a]===e)throw new Error("The indicated drop target is not attached at the anchor `"+a+"`.");return delete t.targets[a],e}}]),n.directive("dropTarget",["$parse","dragContext",function(t,r){return{restrict:"A",require:["^dropContainer","dropTarget"],scope:!0,bindToController:{anchor:"@dropTarget"},controller:a.noop,controllerAs:"dropTarget",link:function(r,e,n,o){var d=o[0],l=o[1];n.$addClass("drop-target"),l.$attrs=n,l.$scope=r,n.$addClass("drop-target drop-target-"+l.anchor),d.attach(l);var i=l.$attrs.onDragEnter?t(l.$attrs.onDragEnter):a.noop,s=l.$attrs.onDragLeave?t(l.$attrs.onDragLeave):a.noop,g=l.$attrs.onDragOver?t(l.$attrs.onDragOver):a.noop,c=l.$attrs.onDrop?t(l.$attrs.onDrop):a.noop;l.handleDragEnter=function(t,r){i(l.$scope,r)},l.handleDragLeave=function(t,r){s(l.$scope,r)},l.handleDragOver=function(t,r){g(l.$scope,r)},l.handleDrop=function(t,r){c(l.$scope,r)},r.$on("$destroy",function(){d.detach(l)})}}}])}])});